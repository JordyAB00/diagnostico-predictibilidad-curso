<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R-Lab Challenge: Misi√≥n Estad√≠stica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .game-setup {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .setup-section {
            margin-bottom: 20px;
        }

        .setup-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .player-setup {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .player-input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            flex: 1;
            min-width: 150px;
        }

        .player-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .game-mode-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .mode-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border: 3px solid #ecf0f1;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-card:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .mode-card.selected {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .mode-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .mode-description {
            color: #7f8c8d;
            font-size: 14px;
        }

        .game-area {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            display: none;
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .challenge-info {
            flex: 1;
        }

        .challenge-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .challenge-subtitle {
            color: #7f8c8d;
        }

        .score-panel {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .score-item {
            text-align: center;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            min-width: 80px;
        }

        .score-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
        }

        .score-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .challenge-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .r-code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .data-display {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
        }

        .question-area {
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-text {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .answer-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .answer-input {
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            min-width: 150px;
        }

        .answer-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #27ae60;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #e74c3c;
        }

        .feedback.partial {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #f39c12;
        }

        .player-turns {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-card {
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #ecf0f1;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-card.active {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .player-card.completed {
            border-color: #27ae60;
            background: #d4edda;
        }

        .player-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .player-score {
            font-size: 12px;
            color: #7f8c8d;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            transition: width 0.5s ease;
        }

        .instructions-box {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .instructions-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .hint-box {
            background: #fff3cd;
            border: 2px solid #f39c12;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .hint-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
        }

        .final-results {
            text-align: center;
            padding: 20px;
        }

        .winner-announcement {
            font-size: 2em;
            color: #27ae60;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th,
        .results-table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            text-align: center;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .challenge-header {
                flex-direction: column;
                text-align: center;
            }
            
            .score-panel {
                justify-content: center;
            }
            
            .answer-section {
                flex-direction: column;
            }
        }
    </style>
    </head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ R-Lab Challenge: Misi√≥n Estad√≠stica</h1>
            <p>Juego colaborativo basado en el script de fundamentos estad√≠sticos en R</p>
        </div>

        <!-- Setup del Juego -->
        <div class="game-setup" id="gameSetup">
            <div class="setup-section">
                <h3>üë• Configurar Jugadores del Equipo</h3>
                <div class="player-setup">
                    <input type="text" class="player-input" placeholder="Nombre del jugador 1" id="player1">
                    <input type="text" class="player-input" placeholder="Nombre del jugador 2" id="player2">
                    <input type="text" class="player-input" placeholder="Nombre del jugador 3" id="player3">
                    <input type="text" class="player-input" placeholder="Nombre del jugador 4" id="player4">
                </div>
                <button class="btn btn-success" onclick="game.addMorePlayers()">+ Agregar m√°s jugadores</button>
            </div>

            <div class="setup-section">
                <h3>üéÆ Seleccionar Modo de Juego</h3>
                <div class="game-mode-selector">
                    <div class="mode-card selected" data-mode="collaborative">
                        <div class="mode-title">ü§ù Colaborativo</div>
                        <div class="mode-description">Todo el equipo resuelve cada desaf√≠o juntos</div>
                    </div>
                    <div class="mode-card" data-mode="turns">
                        <div class="mode-title">üîÑ Por Turnos</div>
                        <div class="mode-description">Cada jugador resuelve un desaf√≠o individualmente</div>
                    </div>
                    <div class="mode-card" data-mode="speed">
                        <div class="mode-title">‚ö° Competencia R√°pida</div>
                        <div class="mode-description">Carrera contra el tiempo, primero que responde gana</div>
                    </div>
                </div>
            </div>

            <div class="setup-section">
                <h3>‚öôÔ∏è Configuraciones</h3>
                <label>
                    <input type="checkbox" id="showHints" checked> Mostrar pistas de R
                </label><br>
                <label>
                    <input type="checkbox" id="showCode" checked> Mostrar c√≥digo de ejemplo
                </label><br>
                <label>
                    Dificultad: 
                    <select id="difficulty">
                        <option value="easy">F√°cil</option>
                        <option value="medium" selected>Medio</option>
                        <option value="hard">Dif√≠cil</option>
                    </select>
                </label>
            </div>

            <button class="btn btn-primary" onclick="game.startGame()" style="width: 100%; font-size: 18px; padding: 15px;">
                üöÄ ¬°Comenzar Aventura Estad√≠stica!
            </button>
        </div>

        <!-- √Årea del Juego -->
        <div class="game-area" id="gameArea">
            <div class="challenge-header">
                <div class="challenge-info">
                    <div class="challenge-title" id="challengeTitle">Desaf√≠o 1</div>
                    <div class="challenge-subtitle" id="challengeSubtitle">Medidas de Tendencia Central</div>
                </div>
                <div class="score-panel">
                    <div class="score-item">
                        <div class="score-value" id="currentScore">0</div>
                        <div class="score-label">Puntos</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="challengeNumber">1</div>
                        <div class="score-label">Desaf√≠o</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="totalChallenges">8</div>
                        <div class="score-label">Total</div>
                    </div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- Panel de turnos (solo visible en modo turnos) -->
            <div class="player-turns" id="playerTurns" style="display: none;">
                <!-- Se llenar√° din√°micamente -->
            </div>

            <div class="challenge-content" id="challengeContent">
                <!-- Contenido del desaf√≠o actual -->
            </div>

            <div class="question-area">
                <div class="question-text" id="questionText">
                    <!-- Pregunta actual -->
                </div>
                <div class="answer-section" id="answerSection">
                    <!-- Inputs de respuesta -->
                </div>
                <button class="btn btn-primary" onclick="game.submitAnswer()">Enviar Respuesta</button>
                <button class="btn btn-warning" onclick="game.getHint()" id="hintBtn">üí° Pista</button>
                <button class="btn btn-danger" onclick="game.skipChallenge()">‚è≠Ô∏è Saltar</button>
            </div>

            <div class="feedback" id="feedback">
                <!-- Retroalimentaci√≥n -->
            </div>

            <div class="instructions-box" id="instructionsBox" style="display: none;">
                <div class="instructions-title">üìö Instrucciones en R:</div>
                <div id="instructionsContent"></div>
            </div>
        </div>

        <!-- Resultados Finales -->
        <div class="game-area" id="finalResults" style="display: none;">
            <div class="final-results">
                <div class="winner-announcement" id="winnerText">
                    üèÜ ¬°Misi√≥n Completada!
                </div>
                <div id="teamSummary" style="margin: 20px 0;"></div>
                <table class="results-table" id="resultsTable">
                    <!-- Tabla de resultados -->
                </table>
                <button class="btn btn-primary" onclick="game.resetGame()" style="margin-top: 20px;">
                    üîÑ Nueva Misi√≥n
                </button>
            </div>
        </div>
    </div>

    <script>
        class RLabChallenge {
            constructor() {
                this.players = [];
                this.currentChallenge = 0;
                this.gameMode = 'collaborative';
                this.currentPlayer = 0;
                this.totalScore = 0;
                this.playerScores = {};
                this.challengeHistory = [];
                this.hintsUsed = 0;
                this.gameSettings = {
                    showHints: true,
                    showCode: true,
                    difficulty: 'medium'
                };
                
                this.challenges = this.generateChallenges();
                this.setupEventListeners();
            }

            generateChallenges() {
                return [
                    {
                        id: 1,
                        title: "Medidas de Tendencia Central",
                        subtitle: "An√°lisis b√°sico con vectores en R",
                        content: "Trabajar√°s con el vector de edades del script:",
                        data: [23, 25, 22, 24, 26, 25, 23, 27, 24, 25],
                        rCode: `edades <- c(23, 25, 22, 24, 26, 25, 23, 27, 24, 25)
# Media
mean(edades)
# Mediana  
median(edades)
# Moda (funci√≥n personalizada)
obtener_moda <- function(x) {
  tabla <- table(x)
  moda <- names(tabla)[which.max(tabla)]
  return(as.numeric(moda))
}
obtener_moda(edades)`,
                        question: "Calcula la media, mediana y moda de este vector:",
                        answers: { media: 24.4, mediana: 24.5, moda: 25 },
                        tolerance: 0.1,
                        hints: [
                            "Usa mean() para la media aritm√©tica",
                            "Usa median() para el valor central", 
                            "La moda es el valor m√°s frecuente (usa la funci√≥n del script)"
                        ],
                        maxPoints: 15
                    },
                    {
                        id: 2,
                        title: "Medidas de Dispersi√≥n",
                        subtitle: "Varianza y desviaci√≥n est√°ndar",
                        content: "Continuando con el vector de edades:",
                        data: [23, 25, 22, 24, 26, 25, 23, 27, 24, 25],
                        rCode: `# Varianza
var(edades)
# Desviaci√≥n est√°ndar
sd(edades)
# Verificar: sd = sqrt(var)
sqrt(var(edades))`,
                        question: "Calcula la varianza y desviaci√≥n est√°ndar:",
                        answers: { varianza: 2.266667, desvest: 1.505543 },
                        tolerance: 0.01,
                        hints: [
                            "Usa var() para varianza",
                            "Usa sd() para desviaci√≥n est√°ndar",
                            "Verifica que sd = sqrt(var)"
                        ],
                        maxPoints: 10
                    },
                    {
                        id: 3,
                        title: "Resumen Estad√≠stico",
                        subtitle: "Funci√≥n summary() en R",
                        content: "Usando summary() con el vector de edades:",
                        data: [23, 25, 22, 24, 26, 25, 23, 27, 24, 25],
                        rCode: `summary(edades)
# Tambi√©n puedes usar:
quantile(edades, c(0.25, 0.75))`,
                        question: "¬øCu√°les son el primer cuartil (Q1) y tercer cuartil (Q3)?",
                        answers: { q1: 23.00, q3: 25.75 },
                        tolerance: 0.01,
                        hints: [
                            "summary() da estad√≠sticas completas",
                            "Q1 = percentil 25, Q3 = percentil 75",
                            "quantile() para percentiles espec√≠ficos"
                        ],
                        maxPoints: 10
                    },
                    {
                        id: 4,
                        title: "Generaci√≥n de Datos Normales",
                        subtitle: "Trabajando con distribuciones",
                        content: "Genera datos de una distribuci√≥n normal como en el script:",
                        rCode: `set.seed(123)
datos_normales <- rnorm(100, mean = 50, sd = 10)
mean(datos_normales)
sd(datos_normales)`,
                        question: "Con set.seed(123), ¬øcu√°l es la media de rnorm(100, mean=50, sd=10)?",
                        answers: { media: 50.10811 },
                        tolerance: 0.01,
                        hints: [
                            "Usa set.seed(123) para reproducibilidad",
                            "rnorm(n, mean, sd) genera datos normales", 
                            "Calcula mean() de los datos generados"
                        ],
                        maxPoints: 10
                    },
                    {
                        id: 5,
                        title: "Prueba t de una muestra",
                        subtitle: "Interpretando resultados estad√≠sticos",
                        content: "Usando el vector de edades, realizamos una prueba t:",
                        rCode: `resultado <- t.test(edades, mu = 25)
resultado$p.value
# Si p-valor < 0.05, rechazamos H0`,
                        question: "¬øCu√°l es el p-valor de t.test(edades, mu = 25)?",
                        answers: { pvalor: 0.1037 },
                        tolerance: 0.001,
                        hints: [
                            "t.test() realiza la prueba t",
                            "Accede al p-valor con $p.value",
                            "Compara con Œ± = 0.05 para decisi√≥n"
                        ],
                        maxPoints: 15
                    },
                    {
                        id: 6,
                        title: "Intervalos de Confianza",
                        subtitle: "Estimaci√≥n por intervalos",
                        content: "Calculamos el intervalo de confianza del 95% para las edades:",
                        rCode: `intervalo <- t.test(edades)$conf.int
intervalo[1]  # l√≠mite inferior
intervalo[2]  # l√≠mite superior`,
                        question: "¬øCu√°les son los l√≠mites inferior y superior del IC 95%?",
                        answers: { inferior: 23.32765, superior: 25.47235 },
                        tolerance: 0.01,
                        hints: [
                            "t.test()$conf.int da el intervalo",
                            "[1] es el l√≠mite inferior",
                            "[2] es el l√≠mite superior"
                        ],
                        maxPoints: 10
                    },
                    {
                        id: 7,
                        title: "Correlaci√≥n",
                        subtitle: "Relaci√≥n entre variables",
                        content: "An√°lisis de correlaci√≥n usando datos simulados de propinas:",
                        rCode: `# Datos simulados basados en el dataset tips
correlacion <- cor(tips$total_bill, tips$tip)
correlacion
# Test de correlaci√≥n
cor.test(tips$total_bill, tips$tip)`,
                        question: "Si la correlaci√≥n entre cuenta total y propina es 0.676, ¬øqu√© indica esto?",
                        answers: { correlacion: 0.676, interpretacion: "fuerte" },
                        tolerance: 0.01,
                        hints: [
                            "cor() calcula correlaci√≥n",
                            "Valores entre 0.6-0.8 indican correlaci√≥n fuerte",
                            "Correlaci√≥n positiva: cuando una aumenta, la otra tambi√©n"
                        ],
                        maxPoints: 15
                    },
                    {
                        id: 8,
                        title: "Distribuci√≥n Binomial",
                        subtitle: "Trabajando con distribuciones discretas",
                        content: "An√°lisis de distribuci√≥n binomial del script:",
                        rCode: `# Distribuci√≥n binomial
datos_binomial <- rbinom(50, size = 10, prob = 0.5)
table(datos_binomial)
mean(datos_binomial)`,
                        question: "En rbinom(50, size=10, prob=0.5), ¬øcu√°l es la media te√≥rica?",
                        answers: { media_teorica: 5 },
                        tolerance: 0.1,
                        hints: [
                            "rbinom(n, size, prob) genera datos binomiales",
                            "Media te√≥rica = size √ó prob",
                            "Para size=10 y prob=0.5: media = 10 √ó 0.5"
                        ],
                        maxPoints: 10
                    }
                ];
            }

            setupEventListeners() {
                // Selecci√≥n de modo de juego
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.gameMode = card.dataset.mode;
                    });
                });

                // Enter key para enviar respuestas
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && document.getElementById('gameArea').style.display !== 'none') {
                        this.submitAnswer();
                    }
                });
            }

            addMorePlayers() {
                const playerSetup = document.querySelector('.player-setup');
                const newInput = document.createElement('input');
                const playerCount = playerSetup.children.length + 1;
                
                newInput.type = 'text';
                newInput.className = 'player-input';
                newInput.placeholder = `Nombre del jugador ${playerCount}`;
                newInput.id = `player${playerCount}`;
                
                playerSetup.appendChild(newInput);
            }

            startGame() {
                // Recopilar jugadores
                this.players = [];
                document.querySelectorAll('.player-input').forEach(input => {
                    if (input.value.trim()) {
                        this.players.push(input.value.trim());
                    }
                });

                if (this.players.length === 0) {
                    alert('¬°Ingresa al menos un jugador para comenzar!');
                    return;
                }

                // Configuraciones del juego
                this.gameSettings.showHints = document.getElementById('showHints').checked;
                this.gameSettings.showCode = document.getElementById('showCode').checked;
                this.gameSettings.difficulty = document.getElementById('difficulty').value;

                // Inicializar puntuaciones
                this.players.forEach(player => {
                    this.playerScores[player] = 0;
                });

                // Configurar interfaz seg√∫n modo de juego
                this.setupGameMode();

                // Mostrar √°rea de juego
                document.getElementById('gameSetup').style.display = 'none';
                document.getElementById('gameArea').style.display = 'block';

                // Cargar primer desaf√≠o
                this.loadChallenge(0);
            }

            setupGameMode() {
                const playerTurns = document.getElementById('playerTurns');
                
                if (this.gameMode === 'turns') {
                    playerTurns.style.display = 'flex';
                    this.renderPlayerTurns();
                } else {
                    playerTurns.style.display = 'none';
                }
            }

            renderPlayerTurns() {
                const playerTurns = document.getElementById('playerTurns');
                playerTurns.innerHTML = '';

                this.players.forEach((player, index) => {
                    const playerCard = document.createElement('div');
                    playerCard.className = `player-card ${index === this.currentPlayer ? 'active' : ''}`;
                    playerCard.innerHTML = `
                        <div class="player-name">${player}</div>
                        <div class="player-score">${this.playerScores[player]} puntos</div>
                    `;
                    playerTurns.appendChild(playerCard);
                });
            }

            loadChallenge(challengeIndex) {
                if (challengeIndex >= this.challenges.length) {
                    this.endGame();
                    return;
                }

                this.currentChallenge = challengeIndex;
                const challenge = this.challenges[challengeIndex];

                // Actualizar header
                document.getElementById('challengeTitle').textContent = `Desaf√≠o ${challenge.id}: ${challenge.title}`;
                document.getElementById('challengeSubtitle').textContent = challenge.subtitle;
                document.getElementById('challengeNumber').textContent = challenge.id;

                // Actualizar progreso
                const progressPercent = ((challengeIndex + 1) / this.challenges.length) * 100;
                document.getElementById('progressFill').style.width = `${progressPercent}%`;

                // Renderizar contenido
                this.renderChallengeContent(challenge);
                this.renderQuestion(challenge);

                // Limpiar feedback anterior
                document.getElementById('feedback').style.display = 'none';

                // Actualizar turnos si es necesario
                if (this.gameMode === 'turns') {
                    this.renderPlayerTurns();
                }
            }

            renderChallengeContent(challenge) {
                let content = `<h4>üìä ${challenge.content}</h4>`;

                if (challenge.data) {
                    content += `
                        <div class="data-display">
                            <strong>Datos: ${challenge.data.join(', ')}</strong>
                        </div>
                    `;
                }

                if (this.gameSettings.showCode && challenge.rCode) {
                    content += `
                        <div class="r-code-block">${challenge.rCode}</div>
                    `;
                }

                document.getElementById('challengeContent').innerHTML = content;
            }

            renderQuestion(challenge) {
                document.getElementById('questionText').textContent = challenge.question;

                const answerSection = document.getElementById('answerSection');
                answerSection.innerHTML = '';

                const answerKeys = Object.keys(challenge.answers);
                answerKeys.forEach(key => {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'answer-input';
                    input.placeholder = key.charAt(0).toUpperCase() + key.slice(1);
                    input.id = `answer-${key}`;
                    
                    // Configurar tipo de input seg√∫n la respuesta esperada
                    if (typeof challenge.answers[key] === 'number') {
                        input.type = 'number';
                        input.step = '0.01';
                    }
                    
                    answerSection.appendChild(input);
                });

                // Configurar botones seg√∫n configuraciones
                document.getElementById('hintBtn').style.display = this.gameSettings.showHints ? 'inline-block' : 'none';
            }

            submitAnswer() {
                const challenge = this.challenges[this.currentChallenge];
                const userAnswers = {};
                const answerKeys = Object.keys(challenge.answers);
                
                // Recopilar respuestas del usuario
                answerKeys.forEach(key => {
                    const input = document.getElementById(`answer-${key}`);
                    if (input.type === 'number') {
                        userAnswers[key] = parseFloat(input.value) || 0;
                    } else {
                        userAnswers[key] = input.value.trim().toLowerCase();
                    }
                });

                // Evaluar respuestas
                let correctAnswers = 0;
                let totalAnswers = answerKeys.length;
                let feedback = [];

                answerKeys.forEach(key => {
                    const userValue = userAnswers[key];
                    const correctValue = challenge.answers[key];
                    
                    if (typeof correctValue === 'number') {
                        const tolerance = challenge.tolerance || 0.1;
                        if (Math.abs(userValue - correctValue) <= tolerance) {
                            correctAnswers++;
                            feedback.push(`‚úÖ ${key}: ${userValue} (correcto)`);
                        } else {
                            feedback.push(`‚ùå ${key}: ${userValue} (correcto: ${correctValue})`);
                        }
                    } else {
                        if (userValue === correctValue.toString().toLowerCase()) {
                            correctAnswers++;
                            feedback.push(`‚úÖ ${key}: ${userValue} (correcto)`);
                        } else {
                            feedback.push(`‚ùå ${key}: ${userValue} (correcto: ${correctValue})`);
                        }
                    }
                });

                // Calcular puntos
                const pointsEarned = Math.round((correctAnswers / totalAnswers) * challenge.maxPoints);
                const currentPlayer = this.gameMode === 'turns' ? this.players[this.currentPlayer] : 'equipo';
                
                // Actualizar puntuaciones
                if (this.gameMode === 'turns') {
                    this.playerScores[this.players[this.currentPlayer]] += pointsEarned;
                } else {
                    this.totalScore += pointsEarned;
                }

                // Guardar historial
                this.challengeHistory.push({
                    challenge: challenge.id,
                    player: currentPlayer,
                    score: pointsEarned,
                    maxScore: challenge.maxPoints,
                    answers: userAnswers,
                    correct: correctAnswers,
                    total: totalAnswers
                });

                // Mostrar feedback
                this.showFeedback(correctAnswers, totalAnswers, pointsEarned, challenge.maxPoints, feedback);

                // Actualizar interfaz
                this.updateScoreDisplay();

                // Avanzar al siguiente desaf√≠o o jugador
                setTimeout(() => {
                    this.nextTurn();
                }, 3000);
            }

            showFeedback(correct, total, points, maxPoints, details) {
                const feedback = document.getElementById('feedback');
                const percentage = Math.round((correct / total) * 100);
                
                if (percentage === 100) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = `
                        üéâ ¬°Excelente! ${points}/${maxPoints} puntos<br>
                        ${details.join('<br>')}
                    `;
                } else if (percentage >= 50) {
                    feedback.className = 'feedback partial';
                    feedback.innerHTML = `
                        üìà Bien hecho: ${points}/${maxPoints} puntos (${percentage}% correcto)<br>
                        ${details.join('<br>')}
                    `;
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `
                        üí™ Sigue intentando: ${points}/${maxPoints} puntos<br>
                        ${details.join('<br>')}
                    `;
                }
                
                feedback.style.display = 'block';
            }

            updateScoreDisplay() {
                if (this.gameMode === 'turns') {
                    // Mostrar puntuaci√≥n total del equipo
                    const totalTeamScore = Object.values(this.playerScores).reduce((sum, score) => sum + score, 0);
                    document.getElementById('currentScore').textContent = totalTeamScore;
                } else {
                    document.getElementById('currentScore').textContent = this.totalScore;
                }
            }

            nextTurn() {
                if (this.gameMode === 'turns') {
                    // Avanzar al siguiente jugador
                    this.currentPlayer = (this.currentPlayer + 1) % this.players.length;
                    
                    // Si completamos una ronda completa, avanzar al siguiente desaf√≠o
                    if (this.currentPlayer === 0) {
                        this.loadChallenge(this.currentChallenge + 1);
                    } else {
                        // Mismo desaf√≠o, siguiente jugador
                        this.renderPlayerTurns();
                        document.getElementById('feedback').style.display = 'none';
                        
                        // Limpiar respuestas anteriores
                        document.querySelectorAll('.answer-input').forEach(input => input.value = '');
                    }
                } else {
                    // Modo colaborativo o speed: avanzar al siguiente desaf√≠o
                    this.loadChallenge(this.currentChallenge + 1);
                }
            }

            getHint() {
                const challenge = this.challenges[this.currentChallenge];
                if (challenge.hints && challenge.hints.length > 0) {
                    const randomHint = challenge.hints[Math.floor(Math.random() * challenge.hints.length)];
                    alert(`üí° Pista: ${randomHint}`);
                    this.hintsUsed++;
                } else {
                    alert('No hay pistas disponibles para este desaf√≠o.');
                }
            }

            skipChallenge() {
                if (confirm('¬øEst√°s seguro de que quieres saltar este desaf√≠o?')) {
                    // Registrar como desaf√≠o saltado
                    const currentPlayer = this.gameMode === 'turns' ? this.players[this.currentPlayer] : 'equipo';
                    this.challengeHistory.push({
                        challenge: this.challenges[this.currentChallenge].id,
                        player: currentPlayer,
                        score: 0,
                        maxScore: this.challenges[this.currentChallenge].maxPoints,
                        skipped: true
                    });

                    this.nextTurn();
                }
            }

            endGame() {
                // Calcular estad√≠sticas finales
                const totalPossiblePoints = this.challenges.reduce((sum, challenge) => sum + challenge.maxPoints, 0);
                const finalScore = this.gameMode === 'turns' 
                    ? Object.values(this.playerScores).reduce((sum, score) => sum + score, 0)
                    : this.totalScore;
                
                const totalPossible = totalPossiblePoints * (this.gameMode === 'turns' ? this.players.length : 1);
                const percentage = Math.round((finalScore / totalPossible) * 100);

                // Mostrar resultados finales
                document.getElementById('gameArea').style.display = 'none';
                document.getElementById('finalResults').style.display = 'block';

                // Texto del ganador
                document.getElementById('winnerText').textContent = 
                    `üèÜ ¬°Misi√≥n Completada! ${percentage}% de √©xito`;

                // Resumen del equipo
                document.getElementById('teamSummary').innerHTML = `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>üìä Resumen del Equipo</h3>
                        <p><strong>Puntuaci√≥n Total:</strong> ${finalScore} / ${totalPossible} puntos</p>
                        <p><strong>Porcentaje de √©xito:</strong> ${percentage}%</p>
                        <p><strong>Pistas utilizadas:</strong> ${this.hintsUsed}</p>
                        <p><strong>Desaf√≠os completados:</strong> ${this.challengeHistory.filter(h => !h.skipped).length} / ${this.challenges.length * (this.gameMode === 'turns' ? this.players.length : 1)}</p>
                    </div>
                `;

                // Tabla de resultados
                this.renderResultsTable();
            }

            renderResultsTable() {
                const table = document.getElementById('resultsTable');
                let tableHTML = '';

                if (this.gameMode === 'turns') {
                    // Tabla por jugadores
                    tableHTML = `
                        <thead>
                            <tr>
                                <th>Jugador</th>
                                <th>Puntos</th>
                                <th>Desaf√≠os</th>
                                <th>Promedio</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;

                    this.players.forEach(player => {
                        const playerChallenges = this.challengeHistory.filter(h => h.player === player);
                        const playerScore = this.playerScores[player];
                        const average = playerChallenges.length > 0 ? (playerScore / playerChallenges.length).toFixed(1) : 0;
                        
                        tableHTML += `
                            <tr>
                                <td>${player}</td>
                                <td>${playerScore}</td>
                                <td>${playerChallenges.length}</td>
                                <td>${average}</td>
                            </tr>
                        `;
                    });

                    tableHTML += '</tbody>';
                } else {
                    // Tabla por desaf√≠os
                    tableHTML = `
                        <thead>
                            <tr>
                                <th>Desaf√≠o</th>
                                <th>Puntos</th>
                                <th>M√°ximo</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;

                    this.challengeHistory.forEach(record => {
                        const percentage = Math.round((record.score / record.maxScore) * 100);
                        tableHTML += `
                            <tr>
                                <td>Desaf√≠o ${record.challenge}</td>
                                <td>${record.score}</td>
                                <td>${record.maxScore}</td>
                                <td>${percentage}%</td>
                            </tr>
                        `;
                    });

                    tableHTML += '</tbody>';
                }

                table.innerHTML = tableHTML;
            }

            resetGame() {
                // Reiniciar todas las variables
                this.currentChallenge = 0;
                this.currentPlayer = 0;
                this.totalScore = 0;
                this.playerScores = {};
                this.challengeHistory = [];
                this.hintsUsed = 0;

                // Mostrar setup nuevamente
                document.getElementById('finalResults').style.display = 'none';
                document.getElementById('gameArea').style.display = 'none';
                document.getElementById('gameSetup').style.display = 'block';

                // Limpiar inputs de jugadores
                document.querySelectorAll('.player-input').forEach(input => {
                    input.value = '';
                });

                // Resetear configuraciones
                document.getElementById('showHints').checked = true;
                document.getElementById('showCode').checked = true;
                document.getElementById('difficulty').value = 'medium';

                // Resetear modo de juego
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
                document.querySelector('.mode-card[data-mode="collaborative"]').classList.add('selected');
                this.gameMode = 'collaborative';
          }
        }

        // Inicializar el juego cuando se carga la p√°gina
        const game = new RLabChallenge();
    </script>
</body>
</html>
